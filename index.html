<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Application Tracker</title>
    <!-- Bootstrap CSS for modern styling -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS for additional styling -->
    <style>
        body { background-color: #f8f9fa; }
        .container { max-width: 1200px; }
        .card { border-radius: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .table { border-radius: 10px; overflow: hidden; }
        .btn { transition: all 0.3s; }
        .btn:hover { transform: translateY(-2px); }
        #jobForm { display: none; }
        .edit-mode { background-color: #e9ecef; }
        .printable { display: none; }
        @media print {
            .no-print { display: none; }
            .printable { display: block; }
        }
    </style>
</head>
<body>
    <div class="container my-5">
        <h1 class="text-center mb-4">Job Application Tracker</h1>
        
        <!-- Buttons for actions -->
        <div class="d-flex justify-content-between mb-4 no-print">
            <button class="btn btn-primary" onclick="toggleForm()">Add New Job</button>
            <button class="btn btn-success" onclick="exportToCSV()">Export to CSV</button>
            <div class="input-group" style="width: auto;">
                <input type="file" class="form-control" id="importFile" accept=".csv">
                <button class="btn btn-outline-secondary" onclick="importFromCSV()">Import CSV</button>
            </div>
            <button class="btn btn-info" onclick="printSummary()">Print Summary</button>
        </div>
        
        <!-- Form for adding/editing jobs -->
        <div class="card p-4 mb-4" id="jobForm">
            <form id="jobEntryForm">
                <input type="hidden" id="editIndex">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="jobTitle" class="form-label">Job Title</label>
                        <input type="text" class="form-control" id="jobTitle" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="hiringCompany" class="form-label">Hiring Company</label>
                        <input type="text" class="form-control" id="hiringCompany" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="dateApplication" class="form-label">Date of Application</label>
                        <input type="date" class="form-control" id="dateApplication" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="location" class="form-label">Location</label>
                        <input type="text" class="form-control" id="location">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="salary" class="form-label">Salary</label>
                        <input type="text" class="form-control" id="salary">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="hiringManager" class="form-label">Hiring Manager's Name</label>
                        <input type="text" class="form-control" id="hiringManager">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="recruiterName" class="form-label">Recruiter's Name</label>
                        <input type="text" class="form-control" id="recruiterName">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="recruitingCompany" class="form-label">Recruiting Company</label>
                        <input type="text" class="form-control" id="recruitingCompany">
                    </div>
                </div>
                <div class="mb-3">
                    <label for="jobDetails" class="form-label">Job Details</label>
                    <textarea class="form-control" id="jobDetails" rows="3"></textarea>
                </div>
                <div class="mb-3">
                    <label for="interviewDetails" class="form-label">Interview Details</label>
                    <textarea class="form-control" id="interviewDetails" rows="3"></textarea>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="interviewDate1" class="form-label">Interview Date 1</label>
                        <input type="date" class="form-control" id="interviewDate1">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="interviewDate2" class="form-label">Interview Date 2</label>
                        <input type="date" class="form-control" id="interviewDate2">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="interviewDate3" class="form-label">Interview Date 3</label>
                        <input type="date" class="form-control" id="interviewDate3">
                    </div>
                </div>
                <div class="d-flex justify-content-end">
                    <button type="button" class="btn btn-secondary me-2" onclick="toggleForm()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Job</button>
                </div>
            </form>
        </div>
        
        <!-- Table for displaying jobs -->
        <div class="card mb-4">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>Job Title</th>
                            <th>Hiring Company</th>
                            <th>Date Applied</th>
                            <th>Location</th>
                            <th>Salary</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="jobTableBody"></tbody>
                </table>
            </div>
        </div>
        
        <!-- Upcoming Interviews Diary -->
        <div class="card">
            <h5 class="card-header">Upcoming Interviews (Diary)</h5>
            <div class="card-body">
                <ul class="list-group" id="upcomingInterviews"></ul>
            </div>
        </div>
        
        <!-- Printable summary -->
        <div class="printable" id="printableSummary"></div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- App Logic -->
    <script>
        let jobs = JSON.parse(localStorage.getItem('jobs')) || [];

        function renderJobs() {
            const tbody = document.getElementById('jobTableBody');
            tbody.innerHTML = '';
            jobs.forEach((job, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${job.jobTitle}</td>
                    <td>${job.hiringCompany}</td>
                    <td>${job.dateApplication}</td>
                    <td>${job.location || 'N/A'}</td>
                    <td>${job.salary || 'N/A'}</td>
                    <td class="no-print">
                        <button class="btn btn-sm btn-warning me-1" onclick="editJob(${index})">Edit</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteJob(${index})">Delete</button>
                        <button class="btn btn-sm btn-info" onclick="viewDetails(${index})">Details</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            renderUpcomingInterviews();
        }

        function renderUpcomingInterviews() {
            const list = document.getElementById('upcomingInterviews');
            list.innerHTML = '';
            const now = new Date();
            let interviews = [];
            jobs.forEach((job, jobIndex) => {
                [job.interviewDate1, job.interviewDate2, job.interviewDate3].forEach((date, dateIndex) => {
                    if (date) {
                        const interviewDate = new Date(date);
                        if (interviewDate > now) {
                            interviews.push({
                                date: interviewDate,
                                jobTitle: job.jobTitle,
                                hiringCompany: job.hiringCompany,
                                dateIndex: dateIndex + 1,
                                jobIndex: jobIndex
                            });
                        }
                    }
                });
            });
            interviews.sort((a, b) => a.date - b.date);
            if (interviews.length === 0) {
                list.innerHTML = '<li class="list-group-item">No upcoming interviews.</li>';
            } else {
                interviews.forEach(interview => {
                    const item = document.createElement('li');
                    item.classList.add('list-group-item');
                    item.innerHTML = `
                        <strong>${interview.date.toDateString()}</strong> - ${interview.jobTitle} at ${interview.hiringCompany} (Interview ${interview.dateIndex})
                        <button class="btn btn-sm btn-info float-end" onclick="viewDetails(${interview.jobIndex})">View Job</button>
                    `;
                    list.appendChild(item);
                });
            }
        }

        function toggleForm() {
            const form = document.getElementById('jobForm');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
            if (form.style.display === 'none') {
                document.getElementById('jobEntryForm').reset();
                document.getElementById('editIndex').value = '';
            }
        }

        document.getElementById('jobEntryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const index = document.getElementById('editIndex').value;
            const job = {
                jobTitle: document.getElementById('jobTitle').value,
                hiringCompany: document.getElementById('hiringCompany').value,
                dateApplication: document.getElementById('dateApplication').value,
                location: document.getElementById('location').value,
                salary: document.getElementById('salary').value,
                hiringManager: document.getElementById('hiringManager').value,
                recruiterName: document.getElementById('recruiterName').value,
                recruitingCompany: document.getElementById('recruitingCompany').value,
                jobDetails: document.getElementById('jobDetails').value,
                interviewDetails: document.getElementById('interviewDetails').value,
                interviewDate1: document.getElementById('interviewDate1').value,
                interviewDate2: document.getElementById('interviewDate2').value,
                interviewDate3: document.getElementById('interviewDate3').value
            };

            if (index === '') {
                jobs.push(job);
            } else {
                jobs[index] = job;
            }

            localStorage.setItem('jobs', JSON.stringify(jobs));
            renderJobs();
            toggleForm();
        });

        function editJob(index) {
            toggleForm();
            const job = jobs[index];
            document.getElementById('jobTitle').value = job.jobTitle;
            document.getElementById('hiringCompany').value = job.hiringCompany;
            document.getElementById('dateApplication').value = job.dateApplication;
            document.getElementById('location').value = job.location;
            document.getElementById('salary').value = job.salary;
            document.getElementById('hiringManager').value = job.hiringManager;
            document.getElementById('recruiterName').value = job.recruiterName;
            document.getElementById('recruitingCompany').value = job.recruitingCompany;
            document.getElementById('jobDetails').value = job.jobDetails;
            document.getElementById('interviewDetails').value = job.interviewDetails;
            document.getElementById('interviewDate1').value = job.interviewDate1 || '';
            document.getElementById('interviewDate2').value = job.interviewDate2 || '';
            document.getElementById('interviewDate3').value = job.interviewDate3 || '';
            document.getElementById('editIndex').value = index;
        }

        function deleteJob(index) {
            if (confirm('Are you sure you want to delete this job entry?')) {
                jobs.splice(index, 1);
                localStorage.setItem('jobs', JSON.stringify(jobs));
                renderJobs();
            }
        }

        function viewDetails(index) {
            const job = jobs[index];
            alert(`
Job Title: ${job.jobTitle}
Hiring Company: ${job.hiringCompany}
Date Applied: ${job.dateApplication}
Location: ${job.location || 'N/A'}
Salary: ${job.salary || 'N/A'}
Hiring Manager: ${job.hiringManager || 'N/A'}
Recruiter: ${job.recruiterName || 'N/A'}
Recruiting Company: ${job.recruitingCompany || 'N/A'}
Job Details: ${job.jobDetails || 'N/A'}
Interview Details: ${job.interviewDetails || 'N/A'}
Interview Date 1: ${job.interviewDate1 || 'N/A'}
Interview Date 2: ${job.interviewDate2 || 'N/A'}
Interview Date 3: ${job.interviewDate3 || 'N/A'}
            `);
        }

        function exportToCSV() {
            let csv = 'Job Title,Hiring Company,Date Applied,Location,Salary,Hiring Manager,Recruiter Name,Recruiting Company,Job Details,Interview Details,Interview Date 1,Interview Date 2,Interview Date 3\n';
            jobs.forEach(job => {
                csv += `"${job.jobTitle.replace(/"/g, '""')}","${job.hiringCompany.replace(/"/g, '""')}","${job.dateApplication}","${job.location || ''}","${job.salary || ''}","${job.hiringManager || ''}","${job.recruiterName || ''}","${job.recruitingCompany || ''}","${job.jobDetails.replace(/"/g, '""')}","${job.interviewDetails.replace(/"/g, '""')}","${job.interviewDate1 || ''}","${job.interviewDate2 || ''}","${job.interviewDate3 || ''}"\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'job_applications.csv';
            link.click();
        }

        function importFromCSV() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            if (!file) {
                alert('Please select a CSV file to import.');
                return;
            }
            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                const lines = text.split('\n').filter(line => line.trim());
                if (lines.length < 1) {
                    alert('Empty CSV file.');
                    return;
                }
                // Skip header
                const importedJobs = [];
                for (let i = 1; i < lines.length; i++) {
                    const values = parseCSVLine(lines[i]);
                    if (values.length === 13) {
                        importedJobs.push({
                            jobTitle: values[0],
                            hiringCompany: values[1],
                            dateApplication: values[2],
                            location: values[3],
                            salary: values[4],
                            hiringManager: values[5],
                            recruiterName: values[6],
                            recruitingCompany: values[7],
                            jobDetails: values[8],
                            interviewDetails: values[9],
                            interviewDate1: values[10],
                            interviewDate2: values[11],
                            interviewDate3: values[12]
                        });
                    }
                }
                if (importedJobs.length > 0) {
                    if (confirm(`Import ${importedJobs.length} jobs? This will add to existing jobs.`)) {
                        jobs = jobs.concat(importedJobs);
                        localStorage.setItem('jobs', JSON.stringify(jobs));
                        renderJobs();
                        alert('Import successful!');
                    }
                } else {
                    alert('No valid jobs found in CSV.');
                }
            };
            reader.readAsText(file);
        }

        function parseCSVLine(line) {
            const values = [];
            let current = '';
            let inQuotes = false;
            for (let char of line) {
                if (char === '"' && !inQuotes) {
                    inQuotes = true;
                } else if (char === '"' && inQuotes) {
                    if (current.endsWith('"')) {
                        current = current.slice(0, -1); // Handle escaped quotes
                    } else {
                        inQuotes = false;
                    }
                } else if (char === ',' && !inQuotes) {
                    values.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            values.push(current.trim());
            return values;
        }

        function printSummary() {
            const summary = document.getElementById('printableSummary');
            summary.innerHTML = '<h1>Job Applications Summary</h1>';
            const table = document.createElement('table');
            table.style.width = '100%';
            table.style.borderCollapse = 'collapse';
            table.innerHTML = `
                <thead>
                    <tr>
                        <th style="border: 1px solid #000; padding: 8px;">Job Title</th>
                        <th style="border: 1px solid #000; padding: 8px;">Hiring Company</th>
                        <th style="border: 1px solid #000; padding: 8px;">Date Applied</th>
                        <th style="border: 1px solid #000; padding: 8px;">Location</th>
                        <th style="border: 1px solid #000; padding: 8px;">Salary</th>
                        <th style="border: 1px solid #000; padding: 8px;">Details</th>
                    </tr>
                </thead>
                <tbody>
            `;
            jobs.forEach(job => {
                table.innerHTML += `
                    <tr>
                        <td style="border: 1px solid #000; padding: 8px;">${job.jobTitle}</td>
                        <td style="border: 1px solid #000; padding: 8px;">${job.hiringCompany}</td>
                        <td style="border: 1px solid #000; padding: 8px;">${job.dateApplication}</td>
                        <td style="border: 1px solid #000; padding: 8px;">${job.location || 'N/A'}</td>
                        <td style="border: 1px solid #000; padding: 8px;">${job.salary || 'N/A'}</td>
                        <td style="border: 1px solid #000; padding: 8px;">
                            Hiring Manager: ${job.hiringManager || 'N/A'}<br>
                            Recruiter: ${job.recruiterName || 'N/A'}<br>
                            Recruiting Co: ${job.recruitingCompany || 'N/A'}<br>
                            Job Details: ${job.jobDetails || 'N/A'}<br>
                            Interview Details: ${job.interviewDetails || 'N/A'}<br>
                            Interview Date 1: ${job.interviewDate1 || 'N/A'}<br>
                            Interview Date 2: ${job.interviewDate2 || 'N/A'}<br>
                            Interview Date 3: ${job.interviewDate3 || 'N/A'}
                        </td>
                    </tr>
                `;
            });
            table.innerHTML += '</tbody>';
            summary.appendChild(table);

            // Add upcoming interviews to print summary
            const upcomingHeader = document.createElement('h2');
            upcomingHeader.textContent = 'Upcoming Interviews';
            summary.appendChild(upcomingHeader);
            const upcomingTable = document.createElement('table');
            upcomingTable.style.width = '100%';
            upcomingTable.style.borderCollapse = 'collapse';
            upcomingTable.innerHTML = `
                <thead>
                    <tr>
                        <th style="border: 1px solid #000; padding: 8px;">Date</th>
                        <th style="border: 1px solid #000; padding: 8px;">Job Title</th>
                        <th style="border: 1px solid #000; padding: 8px;">Hiring Company</th>
                        <th style="border: 1px solid #000; padding: 8px;">Interview Number</th>
                    </tr>
                </thead>
                <tbody id="printUpcomingBody"></tbody>
            `;
            const now = new Date();
            let interviews = [];
            jobs.forEach(job => {
                [job.interviewDate1, job.interviewDate2, job.interviewDate3].forEach((date, dateIndex) => {
                    if (date) {
                        const interviewDate = new Date(date);
                        if (interviewDate > now) {
                            interviews.push({
                                date: interviewDate.toDateString(),
                                jobTitle: job.jobTitle,
                                hiringCompany: job.hiringCompany,
                                dateIndex: dateIndex + 1
                            });
                        }
                    }
                });
            });
            interviews.sort((a, b) => new Date(a.date) - new Date(b.date));
            const printBody = upcomingTable.querySelector('#printUpcomingBody');
            if (interviews.length === 0) {
                printBody.innerHTML = '<tr><td colspan="4" style="border: 1px solid #000; padding: 8px;">No upcoming interviews.</td></tr>';
            } else {
                interviews.forEach(interview => {
                    printBody.innerHTML += `
                        <tr>
                            <td style="border: 1px solid #000; padding: 8px;">${interview.date}</td>
                            <td style="border: 1px solid #000; padding: 8px;">${interview.jobTitle}</td>
                            <td style="border: 1px solid #000; padding: 8px;">${interview.hiringCompany}</td>
                            <td style="border: 1px solid #000; padding: 8px;">${interview.dateIndex}</td>
                        </tr>
                    `;
                });
            }
            summary.appendChild(upcomingTable);

            window.print();
        }

        renderJobs();
    </script>
</body>
</html>